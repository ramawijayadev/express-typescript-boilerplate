<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Convention Handbook</title>
  <style>
    /* DESIGN SYSTEM: Matches Architecture Handbook */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap');

    :root {
      --bg-color: #ffffff;
      --text-main: #111827;
      --text-muted: #4b5563;
      --accent-color: #2563eb;
      --border-color: #e5e7eb;
      --code-bg: #f3f4f6;
      --code-text: #db2777;
      --section-bg: #f9fafb;

      /* Convention Status Colors */
      --status-must: #dc2626;
      /* Red - Mandatory */
      --status-should: #d97706;
      /* Orange - Recommended */
      --status-opt: #059669;
      /* Green - Optional */
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Inter', sans-serif;
      line-height: 1.6;
      color: var(--text-main);
      max-width: 850px;
      margin: 0 auto;
      padding: 60px 24px;
      background-color: var(--bg-color);
    }

    h1,
    h2,
    h3,
    h4 {
      font-weight: 700;
      color: var(--text-main);
      letter-spacing: -0.025em;
    }

    h1 {
      font-size: 3.5rem;
      line-height: 1.1;
      margin-bottom: 0.5rem;
      letter-spacing: -0.04em;
    }

    .subtitle {
      font-size: 1.5rem;
      font-weight: 500;
      color: var(--text-muted);
      margin-bottom: 2rem;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 2rem;
    }

    h2 {
      font-size: 1.8rem;
      margin-top: 3.5rem;
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--text-main);
    }

    h3 {
      font-size: 1.25rem;
      margin-top: 2rem;
      margin-bottom: 0.75rem;
      color: var(--text-main);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    p {
      margin-bottom: 1.25rem;
      color: var(--text-muted);
    }

    strong {
      color: var(--text-main);
      font-weight: 600;
    }

    ul,
    ol {
      margin-bottom: 1.5rem;
      padding-left: 1.5rem;
      color: var(--text-muted);
    }

    li {
      margin-bottom: 0.5rem;
    }

    /* Special Box for Intro */
    .intro-box {
      border-left: 4px solid var(--accent-color);
      background-color: var(--section-bg);
      padding: 1.5rem;
      margin-bottom: 3rem;
      border-radius: 0 8px 8px 0;
    }

    /* CODE BLOCKS */
    code {
      font-family: 'JetBrains Mono', monospace;
      background-color: var(--code-bg);
      color: var(--code-text);
      padding: 0.2em 0.4em;
      border-radius: 4px;
      font-size: 0.85em;
      font-weight: 500;
    }

    pre {
      background-color: var(--code-bg);
      padding: 1.5rem;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      overflow-x: auto;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85em;
      line-height: 1.5;
      margin-bottom: 1.5rem;
      color: var(--text-main);
    }

    pre code {
      background-color: transparent;
      padding: 0;
      color: inherit;
      border: none;
    }

    /* BADGES */
    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-family: 'Inter', sans-serif;
      font-size: 0.7rem;
      font-weight: 800;
      padding: 4px 8px;
      border-radius: 6px;
      text-transform: uppercase;
      color: white;
      letter-spacing: 0.05em;
      vertical-align: middle;
      transform: translateY(-2px);
    }

    .bg-wajib {
      background-color: var(--status-must);
    }

    .bg-saran {
      background-color: var(--status-should);
    }

    .bg-opsi {
      background-color: var(--status-opt);
    }

    /* TOC matches Architecture.html */
    .toc {
      background-color: var(--section-bg);
      padding: 2rem;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      margin-bottom: 4rem;
    }

    .toc h3 {
      margin-top: 0;
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
    }

    .toc ul {
      list-style: none;
      padding-left: 0;
      margin-bottom: 0;
    }

    .toc li {
      margin-bottom: 0.5rem;
    }

    .toc a {
      text-decoration: none;
      color: var(--accent-color);
      font-weight: 500;
      transition: color 0.2s;
    }

    .toc a:hover {
      color: var(--text-main);
      text-decoration: underline;
    }

    @media print {
      body {
        padding: 0;
        color: #000;
      }

      h2 {
        break-before: auto;
        page-break-after: avoid;
        border-bottom: 1px solid #000;
      }

      .toc {
        display: none;
      }

      .badge {
        border: 1px solid #000;
        color: #000;
        background: none !important;
      }
    }
  </style>
</head>

<body>

  <header>
    <h1>Convention Handbook</h1>
    <div class="subtitle">Code Conventions & Project Standards</div>
  </header>

  <div class="intro-box">
    <p style="margin:0;">
      <strong>Document Purpose:</strong> To make the codebase consistent, predictable, and serve as a mandatory
      reference for all developers (TypeScript + Express).
    </p>
  </div>

  <nav class="toc">
    <h3>Index</h3>
    <ul>
      <li><a href="#legend">0. Legend</a></li>
      <li><a href="#structure">1. Project Structure</a></li>
      <li><a href="#naming">2. Naming System</a></li>
      <li><a href="#module">3. Module Structure</a></li>
      <li><a href="#role-suffixes">4. File Suffixes</a></li>
      <li><a href="#http">5. HTTP & Routing</a></li>
      <li><a href="#dto">6. Data & Types</a></li>
      <li><a href="#error">7. Error Handling</a></li>
      <li><a href="#imports">8. Import Style</a></li>
      <li><a href="#logging">9. Logging & Hygiene</a></li>
      <li><a href="#testing">10. Testing Conventions</a></li>
      <li><a href="#openapi">11. OpenAPI Documentation</a></li>
    </ul>
  </nav>

  <section id="legend">
    <h2>0. Legend</h2>
    <ul>
      <li><span class="badge bg-wajib">MANDATORY</span> Must be followed in all new code. Violations may start compile
        errors or CI failures.</li>
      <li><span class="badge bg-saran">RECOMMENDED</span> Should be followed. Valid exceptions exist but are rare.</li>
      <li><span class="badge bg-opsi">OPTIONAL</span> May be used if relevant.</li>
    </ul>
  </section>

  <section id="structure">
    <h2>1. Project Structure</h2>

    <h3>1.1. Root structure <span class="badge bg-wajib">MANDATORY</span></h3>
    <pre><code>backend-starterkit/
  eslint.config.mjs   # Flat ESLint rules
  tsconfig.json       # TypeScript Strict Mode
  .env                # Local secrets (gitignored)
  src/                # Application source code
  docs/               # Single Source of Truth</code></pre>

    <h3>1.2. Main structure in src/ <span class="badge bg-wajib">MANDATORY</span></h3>
    <pre><code>src/
  /app          # Bootstrap (server.ts, app.ts)
  /config       # Environment configuration
  /core         # Framework/Infra (http, logging, queue)
  /modules      # Feature Modules (Flatter structure)
  /shared       # Shared utilities (errors, types)
  /cli          # CLI Commands
  /jobs         # Job Workers
  /tests        # Global Tests (E2E, Perf)</code></pre>

    <h3>1.3. Module Flattening <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>Modules are placed directly under <code>src/modules/</code>. We do <strong>NOT</strong> use nested categories
      like
      <code>platform</code> or <code>business</code> to prevent deep nesting fatigue.
    </p>
    <pre><code>src/modules/
  /auth         # Auth Module
  /users        # Users Module
  /health       # Health check
  /jobs         # Job related logic</code></pre>
  </section>

  <section id="naming">
    <h2>2. Naming System</h2>

    <h3>2.1. Files & Folders <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>Use <strong>kebab-case</strong>.</p>
    <pre><code>src/modules/auth/auth.service.ts
src/core/http/middlewares/rate-limiters.ts</code></pre>

    <h3>2.2. Identifiers <span class="badge bg-wajib">MANDATORY</span></h3>
    <ul>
      <li><code>camelCase</code>: variables, functions, methods, instances.</li>
      <li><code>PascalCase</code>: Classes, Types, Interfaces, Enums.</li>
      <li><code>SCREAMING_SNAKE_CASE</code>: Global constants.</li>
    </ul>
  </section>

  <section id="module">
    <h2>3. Module Structure</h2>

    <h3>3.1. One Folder = One Module <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>Everything related to a feature stays inside that folder. No "scattering" code across the app.</p>

    <h3>3.2. Mandated Files <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>A typical module (e.g., <code>auth</code>) must contain:</p>
    <ul>
      <li><code>auth.routes.ts</code>: Route definitions + OpenAPI Registry.</li>
      <li><code>auth.controller.ts</code>: Request handling.</li>
      <li><code>auth.service.ts</code>: Business logic.</li>
      <li><code>auth.repository.ts</code>: Database interaction.</li>
      <li><code>auth.schemas.ts</code>: Zod validation schemas.</li>
      <li><code>auth.types.ts</code>: TypeScript interfaces/types.</li>
    </ul>
  </section>

  <section id="role-suffixes">
    <h2>4. File Suffixes</h2>
    <p>Every file must have a suffix denoting its architectural role.</p>
    <ul>
      <li><code>*.model.ts</code> is <strong>deprecated</strong> (Use Prisma schema + Types).</li>
      <li><code>*.utils.ts</code> is generic specific logic.</li>
      <li><code>*.job.ts</code> for background job definitions.</li>
    </ul>
  </section>

  <section id="http">
    <h2>5. HTTP & Routing Patterns</h2>

    <h3>5.1. Type-Safe Handlers <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>Do NOT use raw <code>(req, res)</code> functions. You must use the type-safe wrappers to ensure body/query strict
      typing.</p>
    <pre><code>// ❌ unsafe
authRouter.post('/login', (req, res) => ...);

// ✅ safe (infers types from LoginBody)
authRouter.post(
  '/login',
  typedHandler&lt;LoginBody&gt;((req, res) => controller.login(req, res))
);</code></pre>

    <h3>5.2. Authenticated Handlers <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>For protected routes, use <code>authenticatedHandler</code> which ensures <code>req.user</code> is present.</p>
    <pre><code>authRouter.post(
  '/revoke',
  authenticate,
  authenticatedHandler((req, res) => controller.revoke(req, res))
);</code></pre>
  </section>

  <section id="dto">
    <h2>6. Data & Types</h2>

    <h3>6.1. Zod First <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>All input (Body, Query, Params) MUST be validated by Zod schemas defined in <code>*.schemas.ts</code>.</p>

    <h3>6.2. Type Inference <span class="badge bg-saran">RECOMMENDED</span></h3>
    <p>Derive TypeScript types from Zod schemas to avoid duplication.</p>
    <pre><code>export type RegisterBody = z.infer&lt;typeof registerSchema&gt;;</code></pre>
  </section>

  <section id="error">
    <h2>7. Error Handling</h2>

    <h3>7.1. AppError <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>Use <code>AppError</code> for all operational errors.</p>
    <pre><code>throw new AppError(StatusCodes.NOT_FOUND, "User not found");</code></pre>

    <h3>7.2. Controller Response <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>Use the helper functions from <code>@/shared/http/api-response</code>.</p>
    <pre><code>// 200 OK
return ok(res, data);
// { success: true, statusCode: 200, message: "OK", data: ..., requestId: "..." }

// 201 Created
return created(res, newUser);</code></pre>
  </section>

  <section id="imports">
    <h2>8. Import Style</h2>

    <h3>8.1. Path Alias (@/) <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>Always use <code>@/</code> for imports outside the current module.</p>
    <pre><code>// ❌ Bad
import { logger } from '../../../core/logging/logger';

// ✅ Good
import { logger } from '@/core/logging/logger';</code></pre>

    <h3>8.2. Import Order <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>Enforced by ESLint. Order: Builtin -> External -> Internal (@/) -> Relative.</p>
  </section>

  <section id="logging">
    <h2>9. Logging & Hygiene</h2>

    <h3>9.1. No Console <span class="badge bg-wajib">MANDATORY</span></h3>
    <p><code>console.log</code> is forbidden by Linter. Use <code>pino</code> logger.</p>

    <h3>9.2. No Any <span class="badge bg-wajib">MANDATORY</span></h3>
    <p><code>no-explicit-any</code> is currently set to ERROR. Do not use <code>any</code>.</p>
  </section>

  <section id="testing">
    <h2>10. Testing Conventions</h2>

    <h3>10.1. Co-location <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>Unit and Integration tests live INSIDE the module folder.</p>
    <pre><code>src/modules/auth/__tests__/
  auth.service.unit.spec.ts
  auth.routes.integration.spec.ts</code></pre>

    <h3>10.2. Global Tests <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>E2E and Performance tests live in `src/tests/`.</p>
  </section>

  <section id="openapi">
    <h2>11. OpenAPI Documentation</h2>

    <h3>11.1. Code-First <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>Every route file must export an <code>OpenAPIRegistry</code>.</p>
    <pre><code>export const authRegistry = new OpenAPIRegistry();

authRegistry.registerPath({
  method: 'post',
  path: '/auth/login',
  request: { ... },
  responses: ...
});</code></pre>
  </section>

  <footer
    style="margin-top: 4rem; border-top: 1px solid var(--border-color); padding-top: 1.5rem; color: var(--text-muted); font-size: 0.875rem;">
    <p>Convention Handbook &mdash; Internal Developer Reference</p>
  </footer>

</body>

</html>