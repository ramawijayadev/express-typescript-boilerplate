<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Convention Handbook</title>
  <style>
    /* DESIGN SYSTEM: Matches Architecture Handbook */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap');

    :root {
      --bg-color: #ffffff;
      --text-main: #111827;
      --text-muted: #4b5563;
      --accent-color: #2563eb;
      --border-color: #e5e7eb;
      --code-bg: #f3f4f6;
      --code-text: #db2777;
      --section-bg: #f9fafb;

      /* Convention Status Colors */
      --status-must: #dc2626;
      /* Red - Mandatory */
      --status-should: #d97706;
      /* Orange - Recommended */
      --status-opt: #059669;
      /* Green - Optional */
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Inter', sans-serif;
      line-height: 1.6;
      color: var(--text-main);
      max-width: 850px;
      margin: 0 auto;
      padding: 60px 24px;
      background-color: var(--bg-color);
    }

    h1,
    h2,
    h3,
    h4 {
      font-weight: 700;
      color: var(--text-main);
      letter-spacing: -0.025em;
    }

    h1 {
      font-size: 3.5rem;
      line-height: 1.1;
      margin-bottom: 0.5rem;
      letter-spacing: -0.04em;
    }

    .subtitle {
      font-size: 1.5rem;
      font-weight: 500;
      color: var(--text-muted);
      margin-bottom: 2rem;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 2rem;
    }

    h2 {
      font-size: 1.8rem;
      margin-top: 3.5rem;
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--text-main);
    }

    h3 {
      font-size: 1.25rem;
      margin-top: 2rem;
      margin-bottom: 0.75rem;
      color: var(--text-main);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    p {
      margin-bottom: 1.25rem;
      color: var(--text-muted);
    }

    strong {
      color: var(--text-main);
      font-weight: 600;
    }

    ul,
    ol {
      margin-bottom: 1.5rem;
      padding-left: 1.5rem;
      color: var(--text-muted);
    }

    li {
      margin-bottom: 0.5rem;
    }

    /* Special Box for Intro */
    .intro-box {
      border-left: 4px solid var(--accent-color);
      background-color: var(--section-bg);
      padding: 1.5rem;
      margin-bottom: 3rem;
      border-radius: 0 8px 8px 0;
    }

    /* CODE BLOCKS */
    code {
      font-family: 'JetBrains Mono', monospace;
      background-color: var(--code-bg);
      color: var(--code-text);
      padding: 0.2em 0.4em;
      border-radius: 4px;
      font-size: 0.85em;
      font-weight: 500;
    }

    pre {
      background-color: var(--code-bg);
      padding: 1.5rem;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      overflow-x: auto;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85em;
      line-height: 1.5;
      margin-bottom: 1.5rem;
      color: var(--text-main);
    }

    pre code {
      background-color: transparent;
      padding: 0;
      color: inherit;
      border: none;
    }

    /* BADGES */
    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-family: 'Inter', sans-serif;
      font-size: 0.7rem;
      font-weight: 800;
      padding: 4px 8px;
      border-radius: 6px;
      text-transform: uppercase;
      color: white;
      letter-spacing: 0.05em;
      vertical-align: middle;
      transform: translateY(-2px);
    }

    .bg-wajib {
      background-color: var(--status-must);
    }

    .bg-saran {
      background-color: var(--status-should);
    }

    .bg-opsi {
      background-color: var(--status-opt);
    }

    /* TOC matches Architecture.html */
    .toc {
      background-color: var(--section-bg);
      padding: 2rem;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      margin-bottom: 4rem;
    }

    .toc h3 {
      margin-top: 0;
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
    }

    .toc ul {
      list-style: none;
      padding-left: 0;
      margin-bottom: 0;
    }

    .toc li {
      margin-bottom: 0.5rem;
    }

    .toc a {
      text-decoration: none;
      color: var(--accent-color);
      font-weight: 500;
      transition: color 0.2s;
    }

    .toc a:hover {
      color: var(--text-main);
      text-decoration: underline;
    }

    @media print {
      body {
        padding: 0;
        color: #000;
      }

      h2 {
        break-before: auto;
        page-break-after: avoid;
        border-bottom: 1px solid #000;
      }

      .toc {
        display: none;
      }

      .badge {
        border: 1px solid #000;
        color: #000;
        background: none !important;
      }
    }
  </style>
</head>

<body>

  <header>
    <h1>Convention Handbook</h1>
    <div class="subtitle">Code Conventions & Project Standards</div>
  </header>

  <div class="intro-box">
    <p style="margin:0;">
      <strong>Document Purpose:</strong> To make the codebase consistent, predictable, and serve as a mandatory
      reference
      for all developers (TypeScript + Express).
    </p>
  </div>

  <nav class="toc">
    <h3>Index</h3>
    <ul>
      <li><a href="#legend">0. Legend</a></li>
      <li><a href="#structure">1. Project Structure</a></li>
      <li><a href="#naming">2. Naming System</a></li>
      <li><a href="#module">3. Module Structure</a></li>
      <li><a href="#suffix">4. Suffix & Roles</a></li>
      <li><a href="#indexusage">5. Index.ts Usage</a></li>
      <li><a href="#http">6. HTTP API & Routing</a></li>
      <li><a href="#dto">7. DTO, Schema, Model</a></li>
      <li><a href="#error">8. Error Handling</a></li>
      <li><a href="#dependency">9. Dependency Rules</a></li>
      <li><a href="#import">10. Import Style</a></li>
      <li><a href="#logging">11. Logging</a></li>
      <li><a href="#context">12. Context Objects</a></li>
      <li><a href="#testing">13. Testing Conventions</a></li>
      <li><a href="#response">14. API Response Standardization</a></li>
      <li><a href="#openapi">15. OpenAPI Documentation Strategy</a></li>
      <li><a href="#pagination">16. Pagination Standards</a></li>
    </ul>
  </nav>

  <section id="legend">
    <h2>0. Legend</h2>
    <ul>
      <li><span class="badge bg-wajib">MANDATORY</span> Must be followed in all new code.</li>
      <li><span class="badge bg-saran">RECOMMENDED</span> Should be followed, unless there is a strong reason not to.
      </li>
      <li><span class="badge bg-opsi">OPTIONAL</span> May be used if relevant.</li>
    </ul>
  </section>

  <section id="structure">
    <h2>1. Project Structure & Main Folders</h2>

    <h3>1.1. Root structure <span class="badge bg-wajib">MANDATORY</span></h3>
    <pre><code>backend-starterkit/
  package.json
  tsconfig.json
  .eslintrc.cjs
  .env.example
  /logs/              # daily log output (gitignored)
  /scripts/           # build/deploy helper scripts
  /docs/              # handbooks, styleguides
  /src/               # application source code</code></pre>

    <h3>1.2. Main structure in src/ <span class="badge bg-wajib">MANDATORY</span></h3>
    <pre><code>src/
  /app          # bootstrap & lifecycle
  /config       # static configuration & env mapping
  /core         # platform & infra (http, db, logging)
  /shared       # utilities & general types (non-domain)
  /modules      # feature-based modules
  /jobs         # background job workers
  /cli          # internal CLI
  /tests        # global tests (integration/e2e)</code></pre>

    <h3>1.3. Module folders in modules/ <span class="badge bg-wajib">MANDATORY</span></h3>
    <pre><code>src/modules/
  /platform     # core features: auth, users, files
  /patterns     # reusable: comments, tags
  /business     # project specific domain</code></pre>
  </section>

  <section id="naming">
    <h2>2. Naming System: Folder, File, Identifier</h2>

    <h3>2.1. Folders & files <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>Use <strong>kebab-case</strong>.</p>
    <pre><code>src/modules/platform/audit-log/audit-log.service.ts
src/core/http/middlewares/request-logger.middleware.ts</code></pre>
    <p>❌ <strong>Forbidden:</strong> Mixing <code>users.service.ts</code> and <code>userService.ts</code>, or generic
      names like <code>helper.ts</code> without context.</p>

    <h3>2.2. Identifiers within code <span class="badge bg-wajib">MANDATORY</span></h3>
    <ul>
      <li><code>camelCase</code> → variable, function, method</li>
      <li><code>PascalCase</code> → class, type, interface, enum</li>
      <li><code>SCREAMING_SNAKE_CASE</code> → global constant</li>
    </ul>
  </section>

  <section id="module">
    <h2>3. Module Structure & File Roles</h2>

    <h3>3.1. 1 folder = 1 module <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>There must be no "floating" modules consisting only of <code>index.ts</code>.</p>

    <h3>3.2. HTTP module: mandatory files <span class="badge bg-wajib">MANDATORY</span></h3>
    <ul>
      <li><code>*.routes.ts</code>: Express route definitions</li>
      <li><code>*.controller.ts</code>: HTTP Adapters</li>
      <li><code>*.service.ts</code>: Business logic</li>
      <li><code>*.repository.ts</code>: Data access</li>
      <li><code>*.schemas.ts</code>: Validation schemas</li>
      <li><code>*.types.ts</code>: TS types / DTOs</li>
    </ul>

    <h3>3.3. File order within folder <span class="badge bg-saran">RECOMMENDED</span></h3>
    <p>For visual consistency in the editor sidebar:</p>
    <ol>
      <li>types</li>
      <li>constants</li>
      <li>schemas</li>
      <li>repository</li>
      <li>service</li>
      <li>routes</li>
      <li>controller</li>
    </ol>
  </section>

  <section id="suffix">
    <h2>4. Suffix & Role-based Naming</h2>

    <h3>4.1. Module file suffixes <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>Every file must have a suffix according to its role: <code>.routes.ts</code>, <code>.controller.ts</code>,
      <code>.service.ts</code>, <code>.repository.ts</code>, <code>.schemas.ts</code>, <code>.types.ts</code>,
      <code>.config.ts</code>.
    </p>

    <h3>4.2. Core/Infra suffixes <span class="badge bg-wajib">MANDATORY</span></h3>
    <p><code>.middleware.ts</code>, <code>.job.ts</code>, <code>.cli.ts</code>, <code>.transport.ts</code>,
      <code>.formatter.ts</code>, <code>.adapter.ts</code>.
    </p>
  </section>

  <section id="indexusage">
    <h2>5. index.ts Usage</h2>

    <h3>5.1. When is it allowed? <span class="badge bg-saran">RECOMMENDED</span></h3>
    <p>Only if the folder serves as a <strong>Facade / Public API</strong> (e.g., <code>src/config/index.ts</code>
      or <code>src/core/logging/index.ts</code>).</p>

    <h3>5.2. When is it FORBIDDEN? <span class="badge bg-wajib">MANDATORY</span></h3>
    <p><strong>Feature module folders</strong> (<code>src/modules/**</code>) must not use <code>index.ts</code>
      barrel exports. Imports must be explicit to the destination file to avoid circular dependencies and navigation
      confusion.</p>
  </section>

  <section id="http">
    <h2>6. HTTP API & Routing</h2>

    <h3>6.1. Base path <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>All public endpoints: <code>/api/v1/...</code></p>

    <h3>6.2. Resource Naming <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>Use <strong>plural nouns</strong>, avoid verbs in paths.</p>
    <ul>
      <li>✅ <code>POST /users</code> (Create user)</li>
      <li>❌ <code>POST /create-user</code></li>
    </ul>

    <h3>6.3. CRUD Standards <span class="badge bg-wajib">MANDATORY</span></h3>
    <pre><code>GET    /resource       (List)
GET    /resource/:id   (Detail)
POST   /resource       (Create)
PUT    /resource/:id   (Full Update)
DELETE /resource/:id   (Delete)</code></pre>

    <h3>6.4. Type-Safe Requests <span class="badge bg-saran">RECOMMENDED</span></h3>
    <p>Avoid manual casting like <code>req.body as unknown as MyDto</code>.</p>
    <ul>
      <li>Use Generics on the Express <code>Request</code> interface, or the <code>TypedRequest</code> helper.</li>
      <li>Ensure runtime validation (Zod Middleware) is in sync with the TS types used in the Controller.</li>
    </ul>
  </section>

  <section id="dto">
    <h2>7. DTO, Schema, & Model Naming</h2>

    <h3>7.1. Domain vs DTO <span class="badge bg-saran">RECOMMENDED</span></h3>
    <ul>
      <li><strong>Entity:</strong> <code>User</code> (Domain object)</li>
      <li><strong>Input:</strong> <code>CreateUserInput</code>, <code>ListUsersFilter</code></li>
      <li><strong>Response:</strong> <code>UserResponse</code>, <code>UserListItem</code></li>
    </ul>

    <h3>7.2. Schema naming <span class="badge bg-wajib">MANDATORY</span></h3>
    <p><code>createUserSchema</code>, <code>updateUserSchema</code>. Avoid generic names like <code>UserDto</code>
      without context.</p>
  </section>

  <section id="error">
    <h2>8. Error Handling</h2>

    <h3>8.1. Base Error <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>Use the <code>AppError</code> class with properties: <code>code</code>, <code>message</code>,
      <code>status</code>.
    </p>

    <h3>8.2. Layer Responsibility <span class="badge bg-wajib">MANDATORY</span></h3>
    <ul>
      <li><strong>Service:</strong> <code>throw new AppError(...)</code>. Must not touch <code>res</code>.</li>
      <li><strong>Controller:</strong> Let errors bubble up (do not catch yourself unless for specific transformation).
      </li>
      <li><strong>Global Handler:</strong> Catch errors, logging, and formatting standard JSON responses.</li>
    </ul>
  </section>

  <section id="dependency">
    <h2>9. Dependency Rules</h2>

    <h3>9.1. Dependency Direction <span class="badge bg-wajib">MANDATORY</span></h3>
    <ul>
      <li><code>core</code> ➔ ❌ modules</li>
      <li><code>shared</code> ➔ ❌ modules</li>
      <li><code>modules</code> ➔ ✅ core, shared, config</li>
    </ul>

    <h3>9.2. Cross-module <span class="badge bg-saran">RECOMMENDED</span></h3>
    <p>If Module A needs Module B, import its <strong>Service</strong>, not its Repository.</p>
  </section>

  <section id="import">
    <h2>10. Import Style</h2>

    <h3>10.1. Path Alias <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>Use <code>@/</code> for absolute imports.</p>
    <pre><code>import { logger } from '@/core/logging/logger';
import { usersRouter } from '@/modules/platform/users/users.routes';</code></pre>

    <h3>10.2. Export Style <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>Use <strong>Named Exports</strong>. Avoid <code>export default</code>.</p>
  </section>

  <section id="logging">
    <h2>11. Logging Conventions</h2>

    <h3>11.1. Single Logger <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>Use logger from <code>@/core/logging/logger</code>. Do not use <code>console.log</code>.</p>

    <h3>11.2. Log Levels <span class="badge bg-wajib">MANDATORY</span></h3>
    <ul>
      <li><code>debug</code>: Dev only.</li>
      <li><code>info</code>: Normal important events (Login, Order Created).</li>
      <li><code>warn</code>: Abnormal but not fatal (Retry, Fallback).</li>
      <li><code>error</code>: System/logic failure (Exception).</li>
    </ul>

    <h3>11.3. Request Logging <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>Must log: <code>requestId</code>, <code>method</code>, <code>path</code>, <code>status</code>,
      <code>durationMs</code>.
    </p>
  </section>

  <section id="context">
    <h2>12. Context Objects</h2>
    <p><span class="badge bg-saran">RECOMMENDED</span> Use suffix <code>.context.ts</code> only for context object
      definitions (e.g., <code>RequestContext</code>). Do not use for regular helper functions.</p>
  </section>

  <section id="testing">
    <h2>13. Testing Conventions</h2>
    <p>This section governs <strong>test placement</strong>, <strong>file naming</strong>, and <strong>level
        separation</strong>.</p>

    <h3>13.1. General principles <span class="badge bg-wajib">MANDATORY</span></h3>
    <ul>
      <li>Tests must follow a <strong>feature-based structure</strong>:
        <ul>
          <li>Tests testing <strong>1 feature/module</strong> → placed in that module's folder.</li>
          <li>Tests testing <strong>multiple features at once (E2E)</strong> → placed in
            <code>src/tests/e2e</code>.
          </li>
        </ul>
      </li>
      <li>All test files use the extension: <code>*.spec.ts</code></li>
    </ul>

    <h3>13.2. Test placement per feature <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>For each module in <code>src/modules/...</code>, tests are placed in a <code>__tests__</code> subdirectory:</p>
    <pre><code>src/modules/users/
  users.routes.ts
  users.service.ts
  ...
  __tests__/
    users.service.unit.spec.ts
    users.repository.unit.spec.ts
    users.routes.integration.spec.ts</code></pre>
    <ul>
      <li>1 module → 1 <code>__tests__</code> folder inside that module folder.</li>
      <li>Test files are <strong>not</strong> placed outside the module if they only test 1 module.</li>
    </ul>

    <h3>13.3. Test levels & file naming <span class="badge bg-saran">RECOMMENDED</span></h3>
    <p>Test levels are distinguished via <strong>file name suffixes</strong>:</p>
    <ul>
      <li><strong>Unit test:</strong> <code>*.unit.spec.ts</code><br>Example: <code>users.service.unit.spec.ts</code>
      </li>
      <li><strong>Integration test:</strong> <code>*.integration.spec.ts</code><br>Example:
        <code>users.routes.integration.spec.ts</code>
      </li>
      <li><strong>E2E (cross-feature):</strong> <code>*.e2e.spec.ts</code><br>Example: <code>auth.e2e.spec.ts</code>
      </li>
    </ul>
    <p><em>If the distinction isn't critical at first, starting with <code>*.spec.ts</code> is acceptable.</em></p>

    <h3>13.4. Folder src/tests <span class="badge bg-saran">RECOMMENDED</span></h3>
    <p>The <code>src/tests</code> folder is used <strong>only for cross-feature / global tests</strong>, not
      per-module.</p>
    <pre><code>src/tests/
  e2e/
    auth.e2e.spec.ts
    full-app.e2e.spec.ts</code></pre>

    <h3>13.5. Tools & framework <span class="badge bg-opsi">OPTIONAL</span></h3>
    <ul>
      <li><strong>Unit & Integration:</strong> Jest / Vitest.</li>
      <li><strong>E2E HTTP:</strong> Supertest / Axios + Jest/Vitest.</li>
    </ul>

    <h3>13.6. Performance / Load Testing <span class="badge bg-opsi">OPTIONAL</span></h3>
    <p>In addition to functional tests, this repository can include performance tests using <strong>k6</strong>.</p>
    <p><strong>Placement:</strong></p>
    <pre><code>tests/
  e2e/
    app.e2e.spec.ts
  perf/
    k6-smoke.js
    k6-stress.js
    k6-soak.js</code></pre>
    <p><strong>Convention:</strong></p>
    <ul>
      <li>The <code>tests/perf</code> folder holds k6 scripts (JavaScript).</li>
      <li>Scripts are <strong>not</strong> part of the main TypeScript codebase and are not run via Vitest.</li>
      <li>File names reflect load type:
        <ul>
          <li><code>k6-smoke.js</code>: Validates basic availability.</li>
          <li><code>k6-stress.js</code>: Increases load to the limit.</li>
          <li><code>k6-soak.js</code>: Stable load for a long duration.</li>
        </ul>
      </li>
    </ul>
  </section>

  <section id="response">
    <h2>14. API Response Standardization</h2>

    <h3>14.1. Standard Format <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>Every API endpoint <strong>MUST</strong> return a response in the following JSON format:</p>
    <pre><code>{
  "status": "success" | "error" | "fail",
  "message": "Human readable message",
  "data": { ... },      // Main payload (object/array)
  "meta": { ... },      // Metadata (pagination, etc)
  "error": { ... }      // Error details (if status != success)
}</code></pre>

    <h3>14.2. Helper Class <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>Use the <code>ApiResponse</code> helper to ensure consistency:</p>
    <pre><code>return ApiResponse.success(res, data, 'User created');
return ApiResponse.error(res, 'Invalid input', 400);</code></pre>
  </section>

  <section id="openapi">
    <h2>15. OpenAPI Documentation Strategy</h2>

    <h3>15.1. Code-First Approach <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>API documentation is generated directly from code using <strong>zod-to-openapi</strong>. Do not write YAML
      manually.</p>

    <h3>15.2. Registry & Generator <span class="badge bg-wajib">MANDATORY</span></h3>
    <ul>
      <li>Define Zod Schema with the <code>openApi()</code> method (e.g.,
        <code>.openapi({ example: '...' })</code>).
      </li>
      <li>Register schema/path to <code>OpenAPIRegistry</code> in the <code>*.routes.ts</code> file.</li>
      <li>Use <code>OpenApiGeneratorV3</code> to build the final spec.</li>
    </ul>
  </section>

  <section id="pagination">
    <h2>16. Pagination Standards</h2>

    <h3>16.1. Query Parameters <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>Use standard parameters: <code>page</code> (number, default 1) and <code>limit</code> (number, default 10).</p>

    <h3>16.2. Response Metadata <span class="badge bg-wajib">MANDATORY</span></h3>
    <p>List responses must include <code>meta</code> and <code>links</code> objects:</p>
    <pre><code>"meta": {
  "total": 100,
  "page": 2,
  "limit": 10,
  "totalPages": 10
},
"links": {
  "first": "/api/resource?page=1",
  "last": "/api/resource?page=10",
  "prev": "/api/resource?page=1",
  "next": "/api/resource?page=3"
}</code></pre>
  </section>

  <footer
    style="margin-top: 4rem; border-top: 1px solid var(--border-color); padding-top: 1.5rem; color: var(--text-muted); font-size: 0.875rem;">
    <p>Convention Handbook Code Conventions &mdash; Internal Use Only</p>
  </footer>

</body>

</html>