<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Core Feature Handbook</title>
  <style>
    /* DESIGN SYSTEM: Matches Architecture, Convention, & Dependency Handbook */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap');

    :root {
      --bg-color: #ffffff;
      --text-main: #111827;
      --text-muted: #4b5563;
      --accent-color: #2563eb;
      --border-color: #e5e7eb;
      --code-bg: #f3f4f6;
      --code-text: #db2777;
      --section-bg: #f9fafb;

      /* Tier Colors */
      --tier-1-bg: #fee2e2;
      --tier-1-text: #991b1b;
      /* Red */
      --tier-2-bg: #ffedd5;
      --tier-2-text: #9a3412;
      /* Orange */
      --tier-3-bg: #dcfce7;
      --tier-3-text: #166534;
      /* Green */
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Inter', sans-serif;
      line-height: 1.6;
      color: var(--text-main);
      max-width: 850px;
      margin: 0 auto;
      padding: 60px 24px;
      background-color: var(--bg-color);
    }

    h1,
    h2,
    h3,
    h4 {
      font-weight: 700;
      color: var(--text-main);
      letter-spacing: -0.025em;
    }

    h1 {
      font-size: 3.5rem;
      line-height: 1.1;
      margin-bottom: 0.5rem;
      letter-spacing: -0.04em;
    }

    .subtitle {
      font-size: 1.5rem;
      font-weight: 500;
      color: var(--text-muted);
      margin-bottom: 2rem;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 2rem;
    }

    h2 {
      font-size: 1.8rem;
      margin-top: 3.5rem;
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--text-main);
    }

    h3 {
      font-size: 1.25rem;
      margin-top: 2rem;
      margin-bottom: 0.75rem;
      color: var(--text-main);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    h4 {
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
    }

    p {
      margin-bottom: 1.25rem;
      color: var(--text-muted);
    }

    strong {
      color: var(--text-main);
      font-weight: 600;
    }

    ul,
    ol {
      margin-bottom: 1.5rem;
      padding-left: 1.5rem;
      color: var(--text-muted);
    }

    li {
      margin-bottom: 0.5rem;
    }

    .intro-box {
      border-left: 4px solid var(--accent-color);
      background-color: var(--section-bg);
      padding: 1.5rem;
      margin-bottom: 3rem;
      border-radius: 0 8px 8px 0;
    }

    code {
      font-family: 'JetBrains Mono', monospace;
      background-color: var(--code-bg);
      color: var(--code-text);
      padding: 0.2em 0.4em;
      border-radius: 4px;
      font-size: 0.85em;
      font-weight: 500;
    }

    pre {
      background-color: var(--code-bg);
      padding: 1.5rem;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      overflow-x: auto;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85em;
      line-height: 1.5;
      margin-bottom: 1.5rem;
      color: var(--text-main);
    }

    pre code {
      background-color: transparent;
      padding: 0;
      color: inherit;
      border: none;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-family: 'Inter', sans-serif;
      font-size: 0.7rem;
      font-weight: 800;
      padding: 4px 10px;
      border-radius: 999px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .tier-1 {
      background-color: var(--tier-1-bg);
      color: var(--tier-1-text);
    }

    .tier-2 {
      background-color: var(--tier-2-bg);
      color: var(--tier-2-text);
    }

    .tier-3 {
      background-color: var(--tier-3-bg);
      color: var(--tier-3-text);
    }

    .module-block {
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      background-color: #fff;
    }

    .module-block h3 {
      margin-top: 0;
    }

    .checklist {
      list-style: none;
      padding-left: 0;
    }

    .checklist li {
      position: relative;
      padding-left: 2rem;
      margin-bottom: 0.75rem;
    }

    /* Checklist Icons */
    .checklist li.done::before {
      content: 'âœ…';
      position: absolute;
      left: 0;
      top: 2px;
      font-size: 1.1em;
    }

    .checklist li.pending::before {
      content: 'ðŸš§';
      position: absolute;
      left: 0;
      top: 2px;
      font-size: 1.1em;
      opacity: 0.8;
    }

    .checklist li.todo::before {
      content: 'Pk';
      position: absolute;
      left: 0;
      top: 2px;
      font-size: 1.1em;
      opacity: 0.4;
    }

    /* Pk is placeholder for checkbox, using unicode */
    .checklist li.todo::before {
      content: 'NB';
      position: absolute;
      left: 0;
      top: 2px;
      font-size: 1.1em;
      opacity: 0.4;
    }

    /* Unicode square */
    .checklist li.todo::before {
      content: 'â¬œ';
    }

    .toc {
      background-color: var(--section-bg);
      padding: 2rem;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      margin-bottom: 4rem;
    }

    .toc h3 {
      margin-top: 0;
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
    }

    .toc ul {
      list-style: none;
      padding-left: 0;
      margin-bottom: 0;
      column-count: 2;
      column-gap: 2rem;
    }

    .toc li {
      margin-bottom: 0.5rem;
    }

    .toc a {
      text-decoration: none;
      color: var(--accent-color);
      font-weight: 500;
      transition: color 0.2s;
    }

    .toc a:hover {
      color: var(--text-main);
      text-decoration: underline;
    }

    @media print {
      body {
        padding: 0;
        color: #000;
      }

      h2 {
        break-before: auto;
        page-break-after: avoid;
        border-bottom: 1px solid #000;
      }

      .toc {
        display: none;
      }

      .module-block {
        break-inside: avoid;
        border: 1px solid #ccc;
      }
    }
  </style>
</head>

<body>

  <header>
    <h1>Core Feature Handbook</h1>
    <div class="subtitle">Implementation Handbook & Checklist</div>
  </header>

  <div class="intro-box">
    <p style="margin:0;">
      This document defines the <strong>Core Features</strong> provided by the backend starter kit. It outlines the
      fundamental features available out-of-the-box and the roadmap for additional modules.
    </p>
  </div>

  <nav class="toc">
    <h3>Index</h3>
    <ul>
      <li><a href="#purpose">1. Purpose & Scope</a></li>
      <li><a href="#tiering">2. Tiering Overview</a></li>
      <li><a href="#tier1">3. Tier 1 â€“ Mandatory</a></li>
      <li><a href="#tier2">4. Tier 2 â€“ Highly Recommended</a></li>
      <li><a href="#tier3">5. Tier 3 â€“ Optional / Advanced</a></li>
      <li><a href="#convention">6. General Conventions</a></li>
      <li><a href="#checklist">7. Implementation Checklist</a></li>
    </ul>
  </nav>

  <section id="purpose">
    <h2>1. Purpose & Scope</h2>
    <p>This document serves as the application functionality "blueprint".</p>
    <ul>
      <li><strong>Standardization:</strong> Defines generic features that are always present.</li>
      <li><strong>Reusability:</strong> Guidelines for creating modules that can be reused in other projects.</li>
      <li><strong>Transparency:</strong> Clearly states what is currently implemented vs. what is planned.</li>
    </ul>
  </section>

  <section id="tiering">
    <h2>2. Tiering Overview</h2>

    <div style="margin-bottom: 1rem;">
      <span class="badge tier-1">Tier 1: Must Have</span>
      <p style="margin-top: 0.5rem;">Core foundation. The boilerplate comes with these features ready to use.</p>
      <ul>
        <li>Auth, User Management, Generic CRUD, Notification System (Email).</li>
      </ul>
    </div>

    <div style="margin-bottom: 1rem;">
      <span class="badge tier-2">Tier 2: Infrastructure</span>
      <p style="margin-top: 0.5rem;">Essential infrastructure layers that are abstracted and ready for implementation.
      </p>
      <ul>
        <li>File Storage Interface, Job Queues, Structured Logging.</li>
      </ul>
    </div>

    <div>
      <span class="badge tier-3">Tier 3: Planned / Optional</span>
      <p style="margin-top: 0.5rem;">Patterns available for implementation when needed.</p>
      <ul>
        <li>RBAC/Roles, Audit Log Entity, Settings, Activity Feed.</li>
      </ul>
    </div>
  </section>

  <section id="tier1">
    <h2>3. Tier 1 â€“ Mandatory <span class="badge tier-1">Core</span></h2>

    <div class="module-block">
      <h3>3.1. Auth Module</h3>
      <p>Secure authentication mechanism with session management.</p>
      <h4>Core Components (Implemented)</h4>
      <ul>
        <li><strong>Entities:</strong> <code>User</code> (contains password hash, lock status), <code>UserSession</code>
          (refresh tokens).</li>
        <li><strong>Security:</strong> Dual-token (Short-lived Access + Long-lived Refresh) with rotation.</li>
        <li><strong>Features:</strong> Register, Login, Logout, Refresh Token, Email Verification, Password Reset,
          Account Locking.</li>
        <li><strong>Algorithm:</strong> <strong>Argon2</strong> hashing & timing-safe comparison.</li>
      </ul>
    </div>

    <div class="module-block">
      <h3>3.2. User Management</h3>
      <p>Identity representation.</p>
      <h4>Core Components (Implemented)</h4>
      <ul>
        <li><strong>Entity:</strong> <code>User</code> (id, email, name, status, timestamps).</li>
        <li><strong>Features:</strong> "Me" profile endpoint, Profile Update.</li>
        <li><strong>Security:</strong> JWT-based Identity Middleware (<code>req.user</code>).</li>
      </ul>
    </div>

    <div class="module-block">
      <h3>3.3. Generic CRUD Pattern</h3>
      <p>Standardized patterns for data operations, pagination, and response formats.</p>
      <h4>Implemented Standards</h4>
      <ul>
        <li><strong>Response:</strong> <code>{ success, data, meta, message }</code> standardized wrapper.</li>
        <li><strong>Pagination:</strong> Standard query params (<code>page</code>, <code>limit</code>) and meta
          response.</li>
        <li><strong>Error Handling:</strong> Global exception handler with operational vs. programming error
          distinction.</li>
      </ul>
    </div>

    <div class="module-block">
      <h3>3.4. Notification Infrastructure</h3>
      <p>Robust framework for sending asynchronous notifications.</p>
      <h4>Core Components (Implemented)</h4>
      <ul>
        <li><strong>Queue:</strong> BullMQ-based email queue with retries and DLQ (Dead Letter Queue).</li>
        <li><strong>Service:</strong> <code>emailSender</code> abstraction (SMTP/Console drivers).</li>
        <li><strong>Workers:</strong> Dedicated background workers for processing email jobs.</li>
      </ul>
    </div>
  </section>

  <section id="tier2">
    <h2>4. Tier 2 â€“ Infrastructure <span class="badge tier-2">Infra</span></h2>

    <div class="module-block">
      <h3>4.1. File / Attachment Infrastructure</h3>
      <p>Abstraction for file handling.</p>
      <h4>Current State</h4>
      <ul>
        <li><strong>Interface:</strong> <code>FileStorage</code> interface defined for modularity.</li>
        <li><strong>Driver:</strong> <code>LocalFileStorage</code> implemented for development.</li>
        <li><strong>Note:</strong> Database entity for Files is currently not enforced, allowing flexibility based on
          business needs.</li>
      </ul>
    </div>

    <div class="module-block">
      <h3>4.2. Observability Infrastructure</h3>
      <p>System visibility and debugging tools.</p>
      <h4>Implemented</h4>
      <ul>
        <li><strong>Logger:</strong> Pino (JSON structured logs) with redaction for sensitive data.</li>
        <li><strong>Correlation:</strong> <code>x-request-id</code> tracking across logs and HTTP requests.</li>
        <li><strong>Health:</strong> <code>/health</code> endpoint monitoring system and job queue status.</li>
      </ul>
    </div>
  </section>

  <section id="tier3">
    <h2>5. Tier 3 â€“ Planned / Optional <span class="badge tier-3">Opt</span></h2>

    <div class="module-block">
      <h3>5.1. RBAC (Role-Based Access Control)</h3>
      <p>Permissions and Role management.</p>
      <ul>
        <li><strong>Status:</strong> Policy-based structure exists in code (<code>acl.service.ts</code>), but DB Schema
          for Roles/Permissions is not yet enforced to keep the starter lightweight.</li>
      </ul>
    </div>

    <div class="module-block">
      <h3>5.2. Audit Log</h3>
      <p>Forensic trail of actions.</p>
      <ul>
        <li><strong>Status:</strong> Covered by Structured Logging (Tier 2). A dedicated database entity
          (<code>AuditLog</code>) is optional and can be added if strict compliance is required.</li>
      </ul>
    </div>
  </section>

  <section id="convention">
    <h2>6. General Conventions</h2>
    <p>Rules for extending the boilerplate:</p>
    <h4>6.1. Naming</h4>
    <p>Module names are lowercase (<code>auth</code>, <code>users</code>). Endpoint URLs are plural
      (<code>/api/v1/users</code>).</p>

    <h4>6.2. Layering</h4>
    <p>Unidirectional flow: Routes â†’ Controller â†’ Service â†’ Repository.</p>

    <h4>6.3. API Contracts</h4>
    <p>Use standard HTTP codes and the defined JSON response envelope.</p>
  </section>

  <section id="checklist">
    <h2>7. Implementation Checklist</h2>
    <p>Current status of the starter kit features.</p>

    <h3>Core Features</h3>
    <ul class="checklist">
      <li class="done"><strong>Auth:</strong> Register, Login, Refresh Token, Secure Headers.</li>
      <li class="done"><strong>Security:</strong> Rate Limiting, Helmet, HPP, CORS.</li>
      <li class="done"><strong>User:</strong> Basic Entity & Profile Management.</li>
      <li class="done"><strong>CRUD:</strong> Base Patterns & Response Wrappers.</li>
      <li class="done"><strong>Jobs:</strong> Queue System (BullMQ) & Workers.</li>
      <li class="done"><strong>Notif:</strong> Email Sending Infrastructure.</li>
    </ul>

    <h3>Infrastructure</h3>
    <ul class="checklist">
      <li class="done"><strong>Logging:</strong> Structured JSON Logging.</li>
      <li class="done"><strong>Config:</strong> Env Validation (Zod).</li>
      <li class="pending"><strong>File:</strong> Storage Abstraction (Implemented), Upload Endpoint (Pending).</li>
      <li class="pending"><strong>Audit:</strong> Via Logs (Implemented), Via DB Entity (Optional/Pending).</li>
    </ul>

    <h3>Advanced</h3>
    <ul class="checklist">
      <li class="todo"><strong>RBAC:</strong> Database-level Role Management.</li>
      <li class="todo"><strong>Settings:</strong> Dynamic System Config.</li>
    </ul>
  </section>

  <footer
    style="margin-top: 4rem; border-top: 1px solid var(--border-color); padding-top: 1.5rem; color: var(--text-muted); font-size: 0.875rem;">
    <p>Core Feature Handbook &mdash; Internal Developer Reference</p>
  </footer>

</body>

</html>